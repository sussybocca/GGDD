<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fauxipedia Social</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: url('https://images.unsplash.com/photo-1615559499593-d0ec58d7d8de?auto=format&fit=crop&w=1950&q=80') no-repeat center center fixed;
    background-size: cover;
    color: white;
  }
  .login-container, .page-container {
    background: rgba(0,0,0,0.7);
    padding: 30px;
    border-radius: 15px;
    max-width: 900px;
    margin: 50px auto;
  }
  input, button {
    width: 90%;
    margin: 5px 0;
    padding: 10px;
    border-radius: 5px;
    border: none;
  }
  button { cursor: pointer; background: #1e90ff; color: white; font-weight: bold; }
  nav a {
    margin: 0 10px;
    color: #1e90ff;
    text-decoration: none;
    font-weight: bold;
  }
  nav a:hover { text-decoration: underline; }
  .article { border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-bottom: 10px; color: white; }
  .post { margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; }
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="auth-container" class="login-container">
  <h1>Welcome to Fauxipedia</h1>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button id="signup">Sign Up</button>
  <button id="login">Login</button>
  <br><br>
  <button id="google-login">Login with Google</button>
  <button id="anonymous-login">Login Anonymously</button>
</div>

<!-- MAIN SITE -->
<div id="main-container" class="page-container" style="display:none;">
  <nav>
    <a href="#" onclick="showPage('articles')">Articles</a> |
    <a href="#" onclick="showPage('minigames')">Mini Games</a> |
    <a href="#" onclick="showPage('about')">About</a> |
    <a href="#" onclick="showPage('social')">Social</a> |
    <button id="logoutBtn">Logout</button>
  </nav>

  <!-- Pages -->
  <div id="articles-page" class="page">
    <h2>Articles</h2>
    <div id="articles"></div>
  </div>

  <div id="minigames-page" class="page" style="display:none;">
    <h2>Mini Games</h2>
    <p>Coming soon!</p>
  </div>

  <div id="about-page" class="page" style="display:none;">
    <h2>About Fauxipedia</h2>
    <p>This is a fake Wikipedia project mixing articles, social feed, and fun experiments.</p>
  </div>

  <div id="social-page" class="page" style="display:none;">
    <h2>Social Feed</h2>
    <div>
      <input type="text" id="postContent" placeholder="Write a new post...">
      <button id="postBtn">Post</button>
    </div>
    <div id="socialFeed"></div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";
  import { 
    getAuth, GoogleAuthProvider, signInWithPopup, signInAnonymously,
    createUserWithEmailAndPassword, signInWithEmailAndPassword,
    signOut, onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { 
    getFirestore, collection, addDoc, getDocs, serverTimestamp, query, orderBy 
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
  import { 
    initializeAppCheck, ReCaptchaV3Provider 
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app-check.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB6xF5RTX6wy87TT17q61nUzoHI70JBkcA",
    authDomain: "funfu-b4ad8.firebaseapp.com",
    projectId: "funfu-b4ad8",
    storageBucket: "funfu-b4ad8.firebasestorage.app",
    messagingSenderId: "400767863064",
    appId: "1:400767863064:web:182b8d5f79aceacf59b66d",
    measurementId: "G-57DN56Z4VM"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);

  const appCheck = initializeAppCheck(app, {
    provider: new ReCaptchaV3Provider('6Ld58csrAAAAABsusleaMoL8CN2phP4Q7b8Rs-X7'),
    isTokenAutoRefreshEnabled: true
  });

  const auth = getAuth(app);
  const db = getFirestore(app);
  const googleProvider = new GoogleAuthProvider();

  const authContainer = document.getElementById("auth-container");
  const mainContainer = document.getElementById("main-container");

  function showPage(page){
    const pages = document.querySelectorAll(".page");
    pages.forEach(p => p.style.display="none");
    document.getElementById(`${page}-page`).style.display="block";
  }

  // --- FULL 3 ARTICLES ~100 words each ---
  const articlesDiv = document.getElementById("articles");
  const fakeArticles = [
    {
      title: "The Cardiean Corporation (1776)",
      content: "Cardiean Corporation, founded by John Coal in 1776, was more than a business—it was a hidden empire. Combining hotels, restaurants, gold mines, and secretive dealings, it required members to commit theft and violence. The legendary Gold Cubes were the ultimate reward; only one survives today, valued at one trillion dollars. Despite its dark practices, the corporation influenced politics, economics, and culture across continents. Stories claim hidden vaults still exist, guarded by loyalists. While historians doubt many claims, Cardiean remains a symbol of greed and power, illustrating how wealth and secrecy can dominate societies and shape history in unexpected ways."
    },
    {
      title: "The Steam Cogitator (1820)",
      content: "The Steam Cogitator, built in London in 1820, was an early attempt at a programmable mechanical computer powered entirely by steam. Using pistons, gears, and massive boilers, it could perform calculations and supposedly even translate codes. Explosions were frequent, drawing criticism from engineers and officials. Secret reports suggest governments used Cogitators for cryptography long before electronic computers existed. Surviving diagrams reveal a surprisingly sophisticated design, foreshadowing modern computing. The machine represents humanity’s early pursuit of automation, highlighting the creativity and daring of engineers experimenting with steam, metal, and mechanical logic, long before the digital age transformed computation and information sharing worldwide."
    },
    {
      title: "The Time Machine Syndicate (3025)",
      content: "By 3025, the Time Machine Syndicate dominated temporal travel, commercializing journeys across centuries. Students could attend schools in ancient civilizations, miners extracted resources from the future, and historians observed past events firsthand. However, such access caused paradoxes, timeline fractures, and wars over disputed histories. The infamous Timeline Crash erased twenty parallel Earths. Despite regulation attempts, the Syndicate remains profitable, driven by public demand and the lure of forbidden knowledge. Its existence raises ethical questions about the manipulation of time, responsibility for alternate histories, and the balance between technological ambition and human consequences, making it both a wonder and a cautionary tale for society."
    }
  ];

  for (let i = 0; i < fakeArticles.length; i++) {
    const a = document.createElement("div");
    a.className = "article";
    a.innerHTML = `<h3>${fakeArticles[i].title}</h3><p>${fakeArticles[i].content}</p>`;
    articlesDiv.appendChild(a);
  }

  // --- AUTH STATE ---
  onAuthStateChanged(auth, async user=>{
    if(user){
      authContainer.style.display="none";
      mainContainer.style.display="block";
      showPage('articles');

      const usersRef = collection(db, "users");
      const userDoc = { 
        username: user.displayName || user.email || "Anonymous",
        email: user.email || "",
        createdAt: serverTimestamp(),
        displayName: user.displayName || "",
        bio: "",
        profilePictureUrl: user.photoURL || ""
      };
      await addDoc(usersRef, userDoc).catch(()=>{});
      loadSocialFeed();
    } else {
      authContainer.style.display="block";
      mainContainer.style.display="none";
    }
  });

  // --- LOGIN / SIGNUP ---
  document.getElementById("signup").addEventListener("click", async ()=>{
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    try{ await createUserWithEmailAndPassword(auth,email,password); } 
    catch(err){ alert(err.message); }
  });

  document.getElementById("login").addEventListener("click", async ()=>{
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    try{ await signInWithEmailAndPassword(auth,email,password); } 
    catch(err){ alert(err.message); }
  });

  document.getElementById("google-login").addEventListener("click", async ()=>{
    try{ await signInWithPopup(auth, googleProvider); } 
    catch(err){ alert(err.message); }
  });

  document.getElementById("anonymous-login").addEventListener("click", async ()=>{
    try{ await signInAnonymously(auth); } 
    catch(err){ alert(err.message); }
  });

  document.getElementById("logoutBtn").addEventListener("click", async ()=>{
    await signOut(auth);
  });

  // --- SOCIAL FEED ---
  const socialFeedDiv = document.getElementById("socialFeed");
  document.getElementById("postBtn").addEventListener("click", async ()=>{
    const content = document.getElementById("postContent").value;
    if(!content) return;
    await addDoc(collection(db, "posts"), {
      userId: auth.currentUser.uid,
      content,
      createdAt: serverTimestamp()
    });
    document.getElementById("postContent").value="";
    loadSocialFeed();
  });

  async function loadSocialFeed(){
    socialFeedDiv.innerHTML = "";
    const q = query(collection(db,"posts"), orderBy("createdAt","desc"));
    const snapshot = await getDocs(q);
    snapshot.forEach(doc=>{
      const post = doc.data();
      const div = document.createElement("div");
      div.className = "post";
      div.textContent = post.content;
      socialFeedDiv.appendChild(div);
    });
  }

</script>
</body>
</html>
